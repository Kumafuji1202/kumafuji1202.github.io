<!doctype html>
<html lang="ja">
    <head>
        <meta charset="utf-8" />
        <title data-translation-key="ui.appName">
            Shavian Alphabet Soft Keyboard
        </title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="pagename" content="Shavian Alphabet Soft Keyboard (wip)" />
        <meta name="author" content="Kumafuji1202" />
        <meta name="twitter:url" content="https://kumafuji1202.github.io/shavian-keyboard/" />
        <link
            rel="canonical"
            href="https://kumafuji1202.github.io/shavian-keyboard/" />
        <meta
            name="twitter:title"
            content="Shavian Alphabet Soft Keyboard (wip)" />
        <meta
            name="twitter:description"
            content="" />
        <link rel="stylesheet" href="../css-global/centered-contents.css" />
        <script src="../js-global/lang.js"></script>
        <script src="../js-global/utils.js"></script>
        <style>
            html {
                background-color: #ffffff;
                --midground: #e0fff0;
                --kbd-main-bg: #c0ffe0;
                --kbd-bottom-bg: #b0ffc0;
                --key-height: 3em;
                --key-bg: #00c080;
                --key-slot-hover-bg: #ffffff;
            }
            #contents {
                background: var(--midground);
            }
            ul {
                list-style: none;
            }
            ul.keyboardRow {
                display: flex;
            }
            #inputArea {
                width: 100%;
                resize: none;
            }
            #keyboard {
                width: inherit;
                /*position: fixed;*/
                bottom: 0;
                user-select: none;
                align-content: center;
            }
            .keyArea {
                background: var(--kbd-main-bg);
                display: none;
            }
            .keyArea.gridKeyboard.current {
                display: grid;
            }
            #bottomBar {
                height: var(--key-height);
                background: var(--kbd-bottom-bg);
                display: flex;
                flex-direction: row;
            }
            #bottomBar > div {
                width: calc(1 * var(--key-height));
            }
            #bottomBar > div#spaceBar {
                font-size: 10px;
                flex-grow: 1;
            }
            .keySlot {
                align-content: center;
            }
            .keySlot:not(.notKey):hover {
                background: var(--key-slot-hover-bg);
            }
            .key {
                background: var(--key-bg);
            }
        </style>
    </head>

    <body>
        <div id="container-flex">
            <div id="contents">
                <h1 data-translation-key="ui.appName"></h1>
                <a href="../">
                    <button data-translation-key="ui.backToTop"></button>
                </a>
                <br />
                <label
                    for="languageSelectBox"
                    data-translation-key="ui.langSelect.label"></label>
                <select id="languageSelectBox"></select>
                <br />
                <textarea
                    id="inputArea"
                    autocomplete="off"
                    autocorrect="off"
                    spellcheck="false"
                    inputmode="none"
                    rows="10"></textarea>
                <label for="inputArea">
                    <div id="keyboard">
                        <div class="keyArea current" id="mainKeys"></div>
                        <div class="keyArea" id="symbolKeys"></div>
                        <div id="bottomBar">
                            <div class="keySlot" title="switch to Orthodox">
                                
                            </div>
                            <div class="keySlot" title="switch" id="switchButton">
                                */êëú
                            </div>
                            <div class="keySlot" title="Numbers and Symbols" id="commaKey">,</div>
                            <div class="keySlot" title="Numbers and Symbols" data-output=" " id="spaceBar">Phonetic 44Keys (KG≈äH)</div>
                            <div class="keySlot" title="Numbers and Symbols" id="periodKey">.</div>
                            <div class="keySlot" title="Numbers and Symbols" id="enterKey">
                                ‚Ü≤
                            </div>
                        </div>
                    </div>
                </label>
            </div>
        </div>
    </body>

    <script>
        //ÁøªË®≥„Éá„Éº„Çø
        new LanguageManager({
            languages: [
                {
                    name: "English",
                    code: "en"
                },
                {
                    name: "Êó•Êú¨Ë™û",
                    code: "ja"
                }
            ],
            translations: {
                "ui.appName": {
                    en: "Shavian Soft Keyboard (wip)",
                    ja: "„Ç∑„Éß„ÉºÊñáÂ≠ó„ÇΩ„Éï„Éà„Ç≠„Éº„Éú„Éº„Éâ(‰ΩúÊàê‰∏≠)",
                },
                "ui.langSelect.label": {
                    en: "Language",
                    ja: "Ë®ÄË™û„ÇíÈÅ∏Êäû"
                },
                "keyboards.phonetic.name": {
                    en: "Phonetic 44Keys (KG≈äH)",
                    ja: "Ë°®Èü≥44„Ç≠„Éº (KG≈äH)"
                },
                "ui.form.placeholder": {
                    en: "Input level data here",
                    ja: "„Åì„Åì„Å´„Çπ„ÉÜ„Éº„Ç∏„Éá„Éº„Çø„ÇíÂÖ•Âäõ..."
                },
                "ui.backToTop": {
                    en: "Return to Top Page",
                    ja: "„Éà„ÉÉ„Éó„Éö„Éº„Ç∏„Å´Êàª„Çã"
                }
            }
        }).initSite(document.getElementById("languageSelectBox"));

        //„Åì„Åì„Åã„ÇâÂÖ•Âäõ
        var inputArea = getElem("inputArea");
        
        var defaultKeyHandlers = {
            //Êó¢ÂÆö„ÅÆ„Ç≠„Éº„Éè„É≥„Éâ„É©„ÄÇ„Ç≠„Éº„ÅÆ‰∏≠Ë∫´„Çí„Åù„ÅÆ„Åæ„ÅæÂá∫Âäõ„Åô„Çã„ÄÇ
            letter: (e) => {
                e.preventDefault();
                let cursorAfterPos = inputArea.selectionStart;
                let output =
                    e.target.getAttribute("data-output") || e.target.innerHTML;
                inputArea.value =
                    inputArea.value.substring(0, cursorAfterPos) +
                    output +
                    inputArea.value.substring(inputArea.selectionEnd);
                //Âº∑Âà∂ÁöÑ„Å´„Éï„Ç©„Éº„Ç´„Çπ„ÇíÊàª„Åô
                inputArea.focus({ focusVisible: false });
                inputArea.selectionEnd = inputArea.selectionStart = cursorAfterPos + output.length;
            },
            enter: (e) => {
                inputArea.value =
                    inputArea.value.substring(0, inputArea.selectionStart) +
                    "\n" +
                    inputArea.value.substring(inputArea.selectionEnd);
                inputArea.selectionEnd = ++inputArea.selectionStart;
            },
            //„Ç´„Éº„ÇΩ„É´„ÇíÁßªÂãï„Åï„Åõ„Çã„Ç≠„Éº
            moveLeft: (e) => {
                e.preventDefault();
                //Âº∑Âà∂ÁöÑ„Å´„Éï„Ç©„Éº„Ç´„Çπ„ÇíÊàª„Åô
                inputArea.focus({ focusVisible: false });
                inputArea.selectionEnd = inputArea.selectionStart -= (inputArea.value.charAt(inputArea.selectionStart - 1).isSurrogate() ? 2 : 1);
            },
            moveRight: (e) => {
                e.preventDefault();
                //Âº∑Âà∂ÁöÑ„Å´„Éï„Ç©„Éº„Ç´„Çπ„ÇíÊàª„Åô
                inputArea.focus({ focusVisible: false });
                inputArea.selectionEnd = inputArea.selectionStart += (inputArea.value.charAt(inputArea.selectionStart).isSurrogate() ? 2 : 1);
            },
            //1ÊñáÂ≠óÂ∑¶„ÇíÂâäÈô§
            delPrev: (e) => {
                e.preventDefault();
                let cursorAfterPos = inputArea.selectionStart;
                if (cursorAfterPos == 0) return; //ÂÖ•Âäõ„ÉÜ„Ç≠„Çπ„Éà„ÅÆÂßã„ÇÅ„Å´„Ç´„Éº„ÇΩ„É´„Åå„ÅÇ„Çã„Å™„Çâ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
                //Ââç„Ååutf16„Åß2„Éê„Ç§„ÉàÊñáÂ≠ó„Åã4„Éê„Ç§„ÉàÊñáÂ≠ó„Åã„ÇíÂà§ÂÆö(„Ç´„Éº„ÇΩ„É´„ÅÆÁõ¥Ââç„ÅÆ„Éê„Ç§„Éà„Åå„Çµ„É≠„Ç≤„Éº„Éà„ÅãÂà§ÂÆö)
                let removeStringSize = inputArea.value.charAt(cursorAfterPos - 1).isSurrogate() ? 2 : 1;
                //Âº∑Âà∂ÁöÑ„Å´„Éï„Ç©„Éº„Ç´„Çπ„ÇíÊàª„Åô
                inputArea.value = inputArea.value.substring(0, cursorAfterPos - removeStringSize) + inputArea.value.substring(inputArea.selectionEnd);
                inputArea.focus({ focusVisible: false });
                inputArea.selectionEnd = inputArea.selectionStart = cursorAfterPos - removeStringSize;
            }
        };

        var keyboardInfo = [
            //display„ÅØnull„Å´„Åô„Çã„Å®handler„ÅåÊåáÂÆö„Åï„Çå„Å™„ÅÑÈôê„ÇäÊó¢ÂÆö„Éè„É≥„Éâ„É©„ÅØÂâ≤„ÇäÂΩì„Å¶„Çâ„Çå„Å™„ÅÑ„ÄÇ
            //handler„ÅØË®≠ÂÆö„Åó„Åü„Çâ„Åù„ÅÆÈÖçÁΩÆ„ÅÆ„Åô„Åπ„Å¶„ÅÆ„Ç≠„Éº„ÅÆÂá¶ÁêÜ„Çí„Åù„Çå„Åß‰ª£„Çè„Çä„Å´Ë°å„ÅÜ„ÄÇ
            //keys[#].handler„ÅØË®≠ÂÆö„Åó„Åü„Çâ„Åù„ÅÆÁâπÂÆö„ÅÆ„Ç≠„Éº„Å´„Å†„ÅëÂá¶ÁêÜ„Çí„Åù„Çå„Åß‰ª£Ë°å„Åô„Çã„ÄÇ
            {
                nameTranslationID: "keyboards.phonetic.name",
                style: "grid",
                size: {
                    width: 10,
                    height: 5
                },
                keys: [
                    //Á¨¨1ÊÆµ
                    "êëí", "êëú", {
                        display: null,
                        position: "1 / 3 / 2 / 5"
                    }, "êëô", "êë£", "êë∞", "êëæ", "êëµ", "êëø",
                    //Á¨¨2ÊÆµ
                    "êëó", "êë°", "êëñ", "êë†", "‚∏∞", "êëò", "êë¶", {
                        // RÂêàÂ≠ó„Ç≠„Éº
                        display: "êëª‚óå·Ä¨",
                        handler: e => {
                            let beforeLetter = inputArea.value.substring(inputArea.selectionStart - inputArea.value.lengthAt(inputArea.selectionStart - 1), inputArea.selectionStart);
                            let letterNum = "êë¶êëæêë©êë∑êë≠êëß".indexOf(beforeLetter);
                            let cursorAfterPos = inputArea.selectionStart;
                            if (letterNum == -1){
                                inputArea.value =
                                    inputArea.value.substring(0, cursorAfterPos) +
                                    "êëª" +
                                    inputArea.value.substring(inputArea.selectionEnd);
                                //Âº∑Âà∂ÁöÑ„Å´„Éï„Ç©„Éº„Ç´„Çπ„ÇíÊàª„Åô
                                inputArea.focus({ focusVisible: false });
                                inputArea.selectionEnd = inputArea.selectionStart = cursorAfterPos + 2;
                            }else{
                                let newLet = "êëΩêëΩêëºêëπêë∏êë∫".substring(letterNum, letterNum+2);
                                inputArea.value =
                                    inputArea.value.substring(0, cursorAfterPos-2) +
                                    newLet +
                                    inputArea.value.substring(inputArea.selectionEnd);
                                //Âº∑Âà∂ÁöÑ„Å´„Éï„Ç©„Éº„Ç´„Çπ„ÇíÊàª„Åô
                                inputArea.focus({ focusVisible: false });
                                inputArea.selectionEnd = inputArea.selectionStart = cursorAfterPos;
                            }
                        }
                    }, "êë´", "êë≤",
                    //Á¨¨3ÊÆµ
                    "êëë", "êëõ", "êëï", "êëü", "êëØ", "êëÆ", "êë±", "êë©", "êë¥", "êë¨",
                    //Á¨¨4ÊÆµ
                    {
                        display: "‚Üê",
                        handler: defaultKeyHandlers.moveLeft
                    },
                    {
                        display: "‚Üí",
                        handler: defaultKeyHandlers.moveRight
                    },
                    "êëî", "êëû", "¬∑", "êë§", "êëß", "êë≥", "êë∑", "êë∂",
                    //Á¨¨5ÊÆµ
                    "êëê", "êëö", "êëì", "êëù", "êë•", "êë¢", "êë®", "êë≠", "êë™", {
                        display: "BS",
                        position: "5 / 10 / 6 / 11",
                        handler: defaultKeyHandlers.delPrev
                    }
                ]
            },
            {
                nameTranslationID: "keyboards.phonetic.name",
                style: "grid",
                size: {
                    width: 10,
                    height: 5
                },
                keys: [
                    "1", "2", "3", "4", "!", "?", "+", "-", "*", "=",
                    "5", "6", "7", "8", "(", ")", "{", "}", "[", "]",
                    "9", "a", "b", "c", ":", ";", "/", "\\", "^", "%",
                    "d", "e", "f", "0", "@", "#", "&", "|", "$", "~",
                    "x", "y", "<", ">", "'", "\"", "`", "‚Ä¶"
                ]
            }
        ];
        function prepareKeyboard(id, keyArea) {
            let k = keyboardInfo[id];
            if (k.style == "grid") {
                //cssÁî®ÊÑè
                keyArea.classList.add("gridKeyboard");
                keyArea.style.height = `calc(${k.size.height} * var(--key-height)`; // k.size.height;
                {
                    let t = "1fr";
                    for (let i = 0; i < k.size.width - 1; i++) {
                        t += " 1fr";
                    }
                    keyArea.style["grid-template-columns"] = t;
                }

                //„Ç≠„ÉºÈÖçÁΩÆ
                for (let key of k.keys) {
                    let keySlotElem = document.createElement("div");
                    keyArea.appendChild(keySlotElem);
                    keySlotElem.classList.add("keySlot");
                    if (typeof key == "string") {
                        keySlotElem.innerHTML = key;
                    } else {
                        keySlotElem.innerHTML = key.display;
                        if (key.position) keySlotElem.style["grid-area"] = key.position;
                        //keySlotElem.style["grid-area"] = (key.position.y + 1) + " / " + (key.position.x + 1);

                        if (key.display === null) {
                            keySlotElem.classList.add("notKey");
                            if (!key.handler) continue;
                        }
                    }
                    keyArea.appendChild(keySlotElem);

                    //„Éè„É≥„Éâ„É©
                    if (key.handler){
                        keySlotElem.setClick(key.handler);
                        continue;
                    }
                    keySlotElem.setClick(defaultKeyHandlers.letter);
                }
            }
        }
        prepareKeyboard(0, getElem("mainKeys"));
        prepareKeyboard(1, getElem("symbolKeys"));
        getElem("spaceBar").setClick(defaultKeyHandlers.letter);
        getElem("periodKey").setClick(defaultKeyHandlers.letter);
        getElem("commaKey").setClick(defaultKeyHandlers.letter);
        getElem("enterKey").setClick(defaultKeyHandlers.enter);
        getElem("switchButton").setClick(function(){
            if (getElem("mainKeys").classList.contains("current")){
                getElem("mainKeys").classList.remove("current");
                getElem("symbolKeys").classList.add("current");
            }else{
                getElem("mainKeys").classList.add("current");
                getElem("symbolKeys").classList.remove("current");
            }
        })
    </script>
</html>

  
