<!doctype html>
<html lang="ja">
    <head>
        <meta charset="utf-8" />
        <title data-translation-key="ui.appName">
            Shavian Alphabet Soft Keyboard
        </title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="pagename" content="Shavian Alphabet Soft Keyboard (wip)" />
        <meta name="author" content="Kumafuji1202" />
        <meta name="twitter:url" content="https://kumafuji1202.github.io/shavian-keyboard/" />
        <link
            rel="canonical"
            href="https://kumafuji1202.github.io/shavian-keyboard/" />
        <meta
            name="twitter:title"
            content="Shavian Alphabet Soft Keyboard (wip)" />
        <meta
            name="twitter:description"
            content="" />
        <link rel="stylesheet" href="../css-global/centered-contents.css" />
        <script src="../js-global/lang.js"></script>
        <script src="../js-global/utils.js"></script>
        <style>
            html {
                background-color: #ffffff;
                --midground: #e0fff0;
                --kbd-main-bg: #c0ffe0;
                --kbd-bottom-bg: #b0ffc0;
                --key-height: 3em;
                --key-bg: #00c080;
                --key-slot-hover-bg: #ffffff;
            }
            #contents {
                background: var(--midground);
            }
            ul {
                list-style: none;
            }
            ul.keyboardRow {
                display: flex;
            }
            #inputArea {
                width: 100%;
                resize: none;
            }
            #keyboard {
                width: inherit;
                /*position: fixed;*/
                bottom: 0;
                user-select: none;
                align-content: center;
            }
            .keyArea {
                background: var(--kbd-main-bg);
                display: none;
            }
            .keyArea.gridKeyboard.current {
                display: grid;
            }
            #bottomBar {
                height: var(--key-height);
                background: var(--kbd-bottom-bg);
                display: flex;
                flex-direction: row;
            }
            #bottomBar > div {
                width: calc(1 * var(--key-height));
            }
            #bottomBar > div#spaceBar {
                font-size: 10px;
                flex-grow: 1;
            }
            .keySlot {
                align-content: center;
            }
            .keySlot:not(.notKey):hover {
                background: var(--key-slot-hover-bg);
            }
            .key {
                background: var(--key-bg);
            }
        </style>
    </head>

    <body>
        <div id="container-flex">
            <div id="contents">
                <h1 data-translation-key="ui.appName"></h1>
                <a href="../">
                    <button data-translation-key="ui.backToTop"></button>
                </a>
                <br />
                <label
                    for="languageSelectBox"
                    data-translation-key="ui.langSelect.label"></label>
                <select id="languageSelectBox"></select>
                <br />
                <textarea
                    id="inputArea"
                    autocomplete="off"
                    autocorrect="off"
                    spellcheck="false"
                    inputmode="none"
                    rows="10"></textarea>
                <label for="inputArea">
                    <div id="keyboard">
                        <div class="keyArea current" id="mainKeys"></div>
                        <div class="keyArea" id="symbolKeys"></div>
                        <div id="bottomBar">
                            <div class="keySlot" title="switch to Orthodox">
                                
                            </div>
                            <div class="keySlot" title="switch" id="switchButton">
                                */ğ‘œ
                            </div>
                            <div class="keySlot" title="Numbers and Symbols" id="commaKey">,</div>
                            <div class="keySlot" title="Numbers and Symbols" data-output=" " id="spaceBar">Phonetic 44Keys (KGÅŠH)</div>
                            <div class="keySlot" title="Numbers and Symbols" id="periodKey">.</div>
                            <div class="keySlot" title="Numbers and Symbols" id="enterKey">
                                â†²
                            </div>
                        </div>
                    </div>
                </label>
            </div>
        </div>
    </body>

    <script>
        //ç¿»è¨³ãƒ‡ãƒ¼ã‚¿
        new LanguageManager({
            languages: [
                {
                    name: "English",
                    code: "en"
                },
                {
                    name: "æ—¥æœ¬èª",
                    code: "ja"
                }
            ],
            translations: {
                "ui.appName": {
                    en: "Shavian Soft Keyboard (wip)",
                    ja: "ã‚·ãƒ§ãƒ¼æ–‡å­—ã‚½ãƒ•ãƒˆã‚­ãƒ¼ãƒœãƒ¼ãƒ‰(ä½œæˆä¸­)",
                },
                "ui.langSelect.label": {
                    en: "Language",
                    ja: "è¨€èªã‚’é¸æŠ"
                },
                "keyboards.phonetic.name": {
                    en: "Phonetic 44Keys (KGÅŠH)",
                    ja: "è¡¨éŸ³44ã‚­ãƒ¼ (KGÅŠH)"
                },
                "ui.form.placeholder": {
                    en: "Input level data here",
                    ja: "ã“ã“ã«ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›..."
                },
                "ui.backToTop": {
                    en: "Return to Top Page",
                    ja: "ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹"
                }
            }
        }).initSite(document.getElementById("languageSelectBox"));

        //ã“ã“ã‹ã‚‰å…¥åŠ›
        var inputArea = getElem("inputArea");
        
        var defaultKeyHandlers = {
            //æ—¢å®šã®ã‚­ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ã€‚ã‚­ãƒ¼ã®ä¸­èº«ã‚’ãã®ã¾ã¾å‡ºåŠ›ã™ã‚‹ã€‚
            letter: (e) => {
                e.preventDefault();
                let cursorAfterPos = inputArea.selectionStart;
                let output =
                    e.target.getAttribute("data-output") || e.target.innerHTML;
                inputArea.value =
                    inputArea.value.substring(0, cursorAfterPos) +
                    output +
                    inputArea.value.substring(inputArea.selectionEnd);
                //å¼·åˆ¶çš„ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’æˆ»ã™
                inputArea.focus({ focusVisible: false });
                inputArea.selectionEnd = inputArea.selectionStart = cursorAfterPos + output.length;
            },
            enter: (e) => {
                inputArea.value =
                    inputArea.value.substring(0, inputArea.selectionStart) +
                    "\n" +
                    inputArea.value.substring(inputArea.selectionEnd);
                inputArea.selectionEnd = ++inputArea.selectionStart;
            },
            //ã‚«ãƒ¼ã‚½ãƒ«ã‚’ç§»å‹•ã•ã›ã‚‹ã‚­ãƒ¼
            moveLeft: (e) => {
                e.preventDefault();
                //å¼·åˆ¶çš„ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’æˆ»ã™
                inputArea.focus({ focusVisible: false });
                inputArea.selectionEnd = inputArea.selectionStart -= (inputArea.value.charAt(inputArea.selectionStart - 1).isSurrogate() ? 2 : 1);
            },
            moveRight: (e) => {
                e.preventDefault();
                //å¼·åˆ¶çš„ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’æˆ»ã™
                inputArea.focus({ focusVisible: false });
                inputArea.selectionEnd = inputArea.selectionStart += (inputArea.value.charAt(inputArea.selectionStart).isSurrogate() ? 2 : 1);
            },
            //1æ–‡å­—å·¦ã‚’å‰Šé™¤
            delPrev: (e) => {
                e.preventDefault();
                let cursorAfterPos = inputArea.selectionStart;
                if (cursorAfterPos == 0) return; //å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆã®å§‹ã‚ã«ã‚«ãƒ¼ã‚½ãƒ«ãŒã‚ã‚‹ãªã‚‰ä½•ã‚‚ã—ãªã„
                //å‰ãŒutf16ã§2ãƒã‚¤ãƒˆæ–‡å­—ã‹4ãƒã‚¤ãƒˆæ–‡å­—ã‹ã‚’åˆ¤å®š(ã‚«ãƒ¼ã‚½ãƒ«ã®ç›´å‰ã®ãƒã‚¤ãƒˆãŒã‚µãƒ­ã‚²ãƒ¼ãƒˆã‹åˆ¤å®š)
                let removeStringSize = inputArea.value.charAt(cursorAfterPos - 1).isSurrogate() ? 2 : 1;
                //å¼·åˆ¶çš„ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’æˆ»ã™
                inputArea.value = inputArea.value.substring(0, cursorAfterPos - removeStringSize) + inputArea.value.substring(inputArea.selectionEnd);
                inputArea.focus({ focusVisible: false });
                inputArea.selectionEnd = inputArea.selectionStart = cursorAfterPos - removeStringSize;
            }
        };

        var keyboardInfo = [
            //displayã¯nullã«ã™ã‚‹ã¨handlerãŒæŒ‡å®šã•ã‚Œãªã„é™ã‚Šæ—¢å®šãƒãƒ³ãƒ‰ãƒ©ã¯å‰²ã‚Šå½“ã¦ã‚‰ã‚Œãªã„ã€‚
            //handlerã¯è¨­å®šã—ãŸã‚‰ãã®é…ç½®ã®ã™ã¹ã¦ã®ã‚­ãƒ¼ã®å‡¦ç†ã‚’ãã‚Œã§ä»£ã‚ã‚Šã«è¡Œã†ã€‚
            //keys[#].handlerã¯è¨­å®šã—ãŸã‚‰ãã®ç‰¹å®šã®ã‚­ãƒ¼ã«ã ã‘å‡¦ç†ã‚’ãã‚Œã§ä»£è¡Œã™ã‚‹ã€‚
            {
                nameTranslationID: "keyboards.phonetic.name",
                style: "grid",
                size: {
                    width: 10,
                    height: 5
                },
                keys: [
                    //ç¬¬1æ®µ
                    "ğ‘’", "ğ‘œ", {
                        display: null,
                        position: "1 / 3 / 2 / 5"
                    }, "ğ‘™", "ğ‘£", "ğ‘°", "ğ‘¾", "ğ‘µ", "ğ‘¿",
                    //ç¬¬2æ®µ
                    "ğ‘—", "ğ‘¡", "ğ‘–", "ğ‘ ", "â¸°", "ğ‘˜", "ğ‘¦", {
                        // Råˆå­—ã‚­ãƒ¼
                        display: "ğ‘»â—Œá€¬",
                        handler: e => {
                            let beforeLetter = inputArea.value.substring(inputArea.selectionStart - inputArea.value.lengthAt(inputArea.selectionStart - 1), inputArea.selectionStart);
                            let letterNum = "ğ‘¦ğ‘¾ğ‘©ğ‘·ğ‘­ğ‘§".indexOf(beforeLetter);
                            let cursorAfterPos = inputArea.selectionStart;
                            if (letterNum == -1){
                                inputArea.value =
                                    inputArea.value.substring(0, cursorAfterPos) +
                                    "ğ‘»" +
                                    inputArea.value.substring(inputArea.selectionEnd);
                                //å¼·åˆ¶çš„ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’æˆ»ã™
                                inputArea.focus({ focusVisible: false });
                                inputArea.selectionEnd = inputArea.selectionStart = cursorAfterPos + 2;
                            }else{
                                let newLet = "ğ‘½ğ‘½ğ‘¼ğ‘¹ğ‘¸ğ‘º".substring(letterNum, letterNum+2);
                                inputArea.value =
                                    inputArea.value.substring(0, cursorAfterPos-2) +
                                    newLet +
                                    inputArea.value.substring(inputArea.selectionEnd);
                                //å¼·åˆ¶çš„ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’æˆ»ã™
                                inputArea.focus({ focusVisible: false });
                                inputArea.selectionEnd = inputArea.selectionStart = cursorAfterPos;
                            }
                        }
                    }, "ğ‘«", "ğ‘²",
                    //ç¬¬3æ®µ
                    "ğ‘‘", "ğ‘›", "ğ‘•", "ğ‘Ÿ", "ğ‘¯", "ğ‘®", "ğ‘±", "ğ‘©", "ğ‘´", "ğ‘¬",
                    //ç¬¬4æ®µ
                    {
                        display: "â†",
                        handler: defaultKeyHandlers.moveLeft
                    },
                    {
                        display: "â†’",
                        handler: defaultKeyHandlers.moveRight
                    },
                    "ğ‘”", "ğ‘", "Â·", "ğ‘¤", "ğ‘§", "ğ‘³", "ğ‘·", "ğ‘¶",
                    //ç¬¬5æ®µ
                    "ğ‘", "ğ‘š", "ğ‘“", "ğ‘", "ğ‘¥", "ğ‘¢", "ğ‘¨", "ğ‘­", "ğ‘ª", {
                        display: "BS",
                        position: "5 / 10 / 6 / 11",
                        handler: defaultKeyHandlers.delPrev
                    }
                ]
            },
            {
                nameTranslationID: "keyboards.phonetic.name",
                style: "grid",
                size: {
                    width: 10,
                    height: 5
                },
                keys: [
                    "1", "2", "3", "4", "!", "?", "+", "-", "*", "=",
                    "5", "6", "7", "8", "(", ")", "{", "}", "[", "]",
                    "9", "a", "b", "c", ":", ";", "/", "\\", "^", "%",
                    "d", "e", "f", "0", "@", "#", "&", "|", "$", "~",
                    "x", "y", "<", ">", "'", "\"", "`", "â€¦"
                ]
            }
        ];
        function prepareKeyboard(id, keyArea) {
            let k = keyboardInfo[id];
            if (k.style == "grid") {
                //cssç”¨æ„
                keyArea.classList.add("gridKeyboard");
                keyArea.style.height = `calc(${k.size.height} * var(--key-height)`; // k.size.height;
                {
                    let t = "1fr";
                    for (let i = 0; i < k.size.width - 1; i++) {
                        t += " 1fr";
                    }
                    keyArea.style["grid-template-columns"] = t;
                }

                //ã‚­ãƒ¼é…ç½®
                for (let key of k.keys) {
                    let keySlotElem = document.createElement("div");
                    keyArea.appendChild(keySlotElem);
                    keySlotElem.classList.add("keySlot");
                    if (typeof key == "string") {
                        keySlotElem.innerHTML = key;
                    } else {
                        keySlotElem.innerHTML = key.display;
                        if (key.position) keySlotElem.style["grid-area"] = key.position;
                        //keySlotElem.style["grid-area"] = (key.position.y + 1) + " / " + (key.position.x + 1);

                        if (key.display === null) {
                            keySlotElem.classList.add("notKey");
                            if (!key.handler) continue;
                        }
                    }
                    keyArea.appendChild(keySlotElem);

                    //ãƒãƒ³ãƒ‰ãƒ©
                    if (key.handler){
                        keySlotElem.setClick(key.handler);
                        continue;
                    }
                    keySlotElem.setClick(defaultKeyHandlers.letter);
                }
            }
        }
        prepareKeyboard(0, getElem("mainKeys"));
        prepareKeyboard(1, getElem("symbolKeys"));
        getElem("spaceBar").setClick(defaultKeyHandlers.letter);
        getElem("periodKey").setClick(defaultKeyHandlers.letter);
        getElem("commaKey").setClick(defaultKeyHandlers.letter);
        getElem("enterKey").setClick(defaultKeyHandlers.enter);
        getElem("switchButton").setClick(function(){
            if (getElem("mainKeys").classList.contains("current")){
                getElem("mainKeys").classList.remove("current");
                getElem("symbolKeys").classList.add("current");
            }else{
                getElem("mainKeys").classList.add("current");
                getElem("symbolKeys").classList.remove("current");
            }
        })
    </script>
</html>

  
