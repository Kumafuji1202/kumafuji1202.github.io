
<!doctype html>
<html lang="ja">
    <head>
        <meta charset="utf-8" />
        <title data-translation-key="ui.appName">
            Shavian Alphabet Soft Keyboard
        </title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="pagename" content="Shavian Alphabet Soft Keyboard (wip)" />
        <meta name="author" content="Kumafuji1202" />
        <meta name="twitter:url" content="https://kumafuji1202.github.io/linguistics/shavian-keyboard/" />
        <meta name="keywords" content="Shavian, ¬∑êëñêë±êëùêëæêëØ, Shavian input">
        <link
            rel="canonical"
            href="https://kumafuji1202.github.io/linguistics/shavian-keyboard/" />
        <meta
            name="twitter:title"
            content="Shavian Alphabet Soft Keyboard (wip)" />
        <meta
            name="twitter:description"
            content="" />
        <meta name="theme-color" content="#001020" />
        <link rel="stylesheet" href="../../css-global/global.css" />
        <link rel="stylesheet" href="../../css-global/centered-contents.css" />
        <script src="../../js-global/lang.js"></script>
        <script src="../../js-global/utils.js"></script>
        <style>
            html {
                background-color: #001020;
                --midground: #001525;
                --outer-text: #ffffff;
                --global-glow: 3px;
                --input-area-bg: #000000;
                --input-text: #ffffff;
                --kbd-main-bg: #003040;
                --kbd-bottom-bg: #002030;
                --key-height: 3em;
                --key-bg: #00c080;
                --key-text: #ffffff;
                --key-active-text: #000000;
                --key-active: #a0ccff;
                --key-slot-active-bg: #a0e0ff;
                color: var(--outer-text);
                text-shadow: 0px 0px var(--global-glow) var(--outer-text);
            }
            button {
                border-color: #aaa;
            }
            #contents {
                background: var(--midground);
                display: flex;
                flex-direction: column;
                padding: 0;
            }
            ul {
                list-style: none;
            }
            ul.keyboardRow {
                display: flex;
            }
            h1{
                font-size: 20px;
            }
            #inputArea {
                resize: none;
                font: inherit;
                border: none;
                flex-grow: 1;
                background: var(--input-area-bg);
                color: var(--input-text);
                text-shadow: 0px 0px var(--global-glow) var(--input-text);
            }
            #inputArea:placeholder-shown{
                text-shadow: none;
            }
            #keyboard {
                width: inherit;
                /*position: fixed;*/
                bottom: 0;
                user-select: none;
                align-content: center;
            }
            .keyArea {
                background: var(--kbd-main-bg);
                display: none;
            }
            .keyArea.gridKeyboard.current {
                display: grid;
            }
            #bottomBar {
                height: var(--key-height);
                background: var(--kbd-bottom-bg);
                display: flex;
                flex-direction: row;
            }
            #bottomBar > div {
                width: calc(1 * var(--key-height));
            }
            #bottomBar > div#spaceBar {
                font-size: 20px;
                flex-grow: 1;
            }
            .keySlot {
                align-content: center;
                transition-duration: 0.5s;
                transition-delay: 100ms;
                color: var(--key-text);
                text-shadow: 0px 0px var(--global-glow) var(--key-text);
            }
            .keySlot:not(.notKey):active {
                background: var(--key-slot-active-bg);
                transition-duration: 0s;
                transition-delay: 0s;
                color: var(--key-active-text);
                text-shadow: 0px 0px var(--global-glow) var(--key-active-text);
            }
            .key {
                background: var(--key-bg);
                color: var(--key-text);
            }
            a {
                color: inherit;
                text-decoration: none;
            }
        </style>
    </head>

    <body>
        <div id="container-flex">
            <div id="contents">
                <h1 data-translation-key="ui.appName"></h1>
                <nav>
                    <button>
                        <a href="../../" data-translation-key="ui.backToTop"></a>
                    </button>
                    <label
                        for="languageSelectBox"
                        data-translation-key="ui.langSelect.label"></label>
                    <select id="languageSelectBox"></select>
                </nav>
                <textarea
                    id="inputArea"
                    data-translation-key="ui.inputArea"
                    autocomplete="off"
                    autocorrect="off"
                    spellcheck="false"
                    inputmode="none"
                    rows="10"></textarea>
                <label for="inputArea">
                    <div id="keyboard">
                        <div class="keyArea current" id="mainKeys"></div>
                        <div class="keyArea" id="symbolKeys"></div>
                        <div id="bottomBar"><!--
                            <div class="keySlot" title="switch to Orthodox">
                                
                            </div>-->
                            <div class="keySlot" title="switch" id="switchButton">
                                êëí/@
                            </div>
                            <!--<div class="keySlot" title="Settings">
                                ‚öô
                            </div>-->
                            <div class="keySlot" id="commaKey">,</div>
                            <div class="keySlot" data-output=" " id="spaceBar" data-translation-key="keyboards.phonetic.name"></div>
                            <div class="keySlot" id="periodKey">.</div>
                            <div class="keySlot" id="enterKey">
                                ‚Ü≤
                            </div>
                        </div>
                    </div>
                </label>
            </div>
        </div>
    </body>

    <script>
        //ÁøªË®≥„Éá„Éº„Çø
        var lang = new LanguageManager({
            languages: [
                {
                    name: "English",
                    code: "en"
                },
                {
                    name: "Êó•Êú¨Ë™û",
                    code: "ja"
                },
                {
                    name: "¬∑êë¶êëôêëúêë§êë¶êëñ (êëñêë±êëùêëæêëØ êë®êë§êëìêë©êëöêëßêëë)",
                    code: "en-Shaw"
                }
            ],
            translations: {
                "ui.appName": {
                    en: "Shavian Soft Keyboard (wip)",
                    ja: "„Ç∑„Éß„ÉºÊñáÂ≠ó„ÇΩ„Éï„Éà„Ç≠„Éº„Éú„Éº„Éâ(‰ΩúÊàê‰∏≠)",
                    "en-Shaw": "¬∑êëñêë±êëùêëæêëØ êëïêë™êëìêëë êëíêë∞êëöêëπêëõ (‚∏∞êë¢êë¶êëê)"
                },
                "ui.langSelect.label": {
                    en: "Select Language/Script",
                    ja: "Ë®ÄË™û/ÊñáÂ≠ó„ÇíÈÅ∏Êäû",
                    "en-Shaw": "êëïêë©êë§êëßêëíêëë êë§êë®êëôêëúêë¢êë¶êë° êëØ êëïêëíêëÆêë¶êëêêëë"
                },
                "ui.inputArea": {
                    en: "Input here...",
                    ja: "„Åì„Åì„Å´ÂÖ•Âäõ‚Ä¶",
                    "en-Shaw": "êë¶êëØêëêêëµêëë êë£êëΩ..."
                },
                "keyboards.phonetic.name": {
                    en: "Phonetic (KG≈äH)",
                    ja: "Ë°®Èü≥ (KG≈äH)",
                    "en-Shaw": "êëìêë©êëØêëßêëëêë¶êëí (êëíêëúêëôêë£)"
                },
                "ui.backToTop": {
                    en: "Return to Top Page",
                    ja: "„Éà„ÉÉ„Éó„Éö„Éº„Ç∏„Å´Êàª„Çã",
                    "en-Shaw": "êëÆêë¶êëëêëªêëØ êëë êëëêë™êëê êëêêë±êë°"
                }
            }
        });
        lang.initSite(document.getElementById("languageSelectBox"));

        //„Åì„Åì„Åã„ÇâÂÖ•Âäõ
        var inputArea = getElem("inputArea");
        
        var defaultKeyHandlers = {
            //Êó¢ÂÆö„ÅÆ„Ç≠„Éº„Éè„É≥„Éâ„É©„ÄÇ„Ç≠„Éº„ÅÆ‰∏≠Ë∫´„Çí„Åù„ÅÆ„Åæ„ÅæÂá∫Âäõ„Åô„Çã„ÄÇ
            letter: (e) => {
                e.preventDefault();
                let cursorAfterPos = inputArea.selectionStart;
                let output =
                    e.target.getAttribute("data-output") || e.target.innerHTML;
                inputArea.value =
                    inputArea.value.substring(0, cursorAfterPos) +
                    output +
                    inputArea.value.substring(inputArea.selectionEnd);
                //Âº∑Âà∂ÁöÑ„Å´„Éï„Ç©„Éº„Ç´„Çπ„ÇíÊàª„Åô
                inputArea.focus({ focusVisible: false });
                inputArea.selectionEnd = inputArea.selectionStart = cursorAfterPos + output.length;
            },
            enter: (e) => {
                e.preventDefault();
                inputArea.value =
                    inputArea.value.substring(0, inputArea.selectionStart) +
                    "\n" +
                    inputArea.value.substring(inputArea.selectionEnd);
                //Âº∑Âà∂ÁöÑ„Å´„Éï„Ç©„Éº„Ç´„Çπ„ÇíÊàª„Åô
                inputArea.focus({ focusVisible: false });
                inputArea.selectionEnd = ++inputArea.selectionStart;
            },
            //„Ç´„Éº„ÇΩ„É´„ÇíÁßªÂãï„Åï„Åõ„Çã„Ç≠„Éº
            moveLeft: (e) => {
                e.preventDefault();
                //Âº∑Âà∂ÁöÑ„Å´„Éï„Ç©„Éº„Ç´„Çπ„ÇíÊàª„Åô
                inputArea.focus({ focusVisible: false });
                inputArea.selectionEnd = inputArea.selectionStart -= (inputArea.value.charAt(inputArea.selectionStart - 1).isSurrogate() ? 2 : 1);
            },
            moveRight: (e) => {
                e.preventDefault();
                //Âº∑Âà∂ÁöÑ„Å´„Éï„Ç©„Éº„Ç´„Çπ„ÇíÊàª„Åô
                inputArea.focus({ focusVisible: false });
                inputArea.selectionEnd = inputArea.selectionStart += (inputArea.value.charAt(inputArea.selectionStart).isSurrogate() ? 2 : 1);
            },
            //1ÊñáÂ≠óÂ∑¶„ÇíÂâäÈô§
            delPrev: (e) => {
                e.preventDefault();
                let cursorAfterPos = inputArea.selectionStart;
                if (cursorAfterPos != 0){ //ÂÖ•Âäõ„ÉÜ„Ç≠„Çπ„Éà„ÅÆÂßã„ÇÅ„Å´„Ç´„Éº„ÇΩ„É´„Åå„ÅÇ„Çã„Å™„Çâ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
                    //Ââç„Ååutf16„Åß2„Éê„Ç§„ÉàÊñáÂ≠ó„Åã4„Éê„Ç§„ÉàÊñáÂ≠ó„Åã„ÇíÂà§ÂÆö(„Ç´„Éº„ÇΩ„É´„ÅÆÁõ¥Ââç„ÅÆ„Éê„Ç§„Éà„Åå„Çµ„É≠„Ç≤„Éº„Éà„ÅãÂà§ÂÆö)
                    let removeStringSize = inputArea.value.charAt(cursorAfterPos - 1).isSurrogate() ? 2 : 1;
                    inputArea.value = inputArea.value.substring(0, cursorAfterPos - removeStringSize) + inputArea.value.substring(inputArea.selectionEnd);
                    inputArea.selectionEnd = inputArea.selectionStart = cursorAfterPos - removeStringSize;
                }
                //Âº∑Âà∂ÁöÑ„Å´„Éï„Ç©„Éº„Ç´„Çπ„ÇíÊàª„Åô
                inputArea.focus({ focusVisible: false });
            }
        };

        var keyboardInfo = {
            //display„ÅØnull„Å´„Åô„Çã„Å®handler„ÅåÊåáÂÆö„Åï„Çå„Å™„ÅÑÈôê„ÇäÊó¢ÂÆö„Éè„É≥„Éâ„É©„ÅØÂâ≤„ÇäÂΩì„Å¶„Çâ„Çå„Å™„ÅÑ„ÄÇ
            //handler„ÅØË®≠ÂÆö„Åó„Åü„Çâ„Åù„ÅÆÈÖçÁΩÆ„ÅÆ„Åô„Åπ„Å¶„ÅÆ„Ç≠„Éº„ÅÆÂá¶ÁêÜ„Çí„Åù„Çå„Åß‰ª£„Çè„Çä„Å´Ë°å„ÅÜ„ÄÇ
            //keys[#].handler„ÅØË®≠ÂÆö„Åó„Åü„Çâ„Åù„ÅÆÁâπÂÆö„ÅÆ„Ç≠„Éº„Å´„Å†„ÅëÂá¶ÁêÜ„Çí„Åù„Çå„Åß‰ª£Ë°å„Åô„Çã„ÄÇ
            //ÂÑ™ÂÖàÂ∫¶: „Ç≠„ÉºÂÄãÂà•„Éè„É≥„Éâ„É© > ÈÖçÁΩÆÊó¢ÂÆö„Éè„É≥„Éâ„É© > defaultKeyHandlers.letter
            
            //„Ç∑„Éß„ÉºÊñáÂ≠ó
            //Ë°®Èü≥44„Ç≠„Éº (KG≈äH)
            "shavian.phonetic": {
                nameTranslationID: "keyboards.phonetic.name",
                style: "grid",
                size: {
                    width: 10,
                    height: 5
                },
                keys: [
                    //Á¨¨1ÊÆµ
                    "êëí", "êëú", {
                        display: null,
                        position: "1 / 3 / 2 / 5"
                    }, "êëô", "êë£", "êë∞", "êëæ", "êëµ", "êëø",
                    //Á¨¨2ÊÆµ
                    "êëó", "êë°", "êëñ", "êë†", "‚∏∞", "êëò", "êë¶", {
                        // RÂêàÂ≠ó„Ç≠„Éº
                        display: "êëª/‚óåêëÆ",
                        handler: e => {
                            let beforeLetter = inputArea.value.substring(inputArea.selectionStart - inputArea.value.lengthAt(inputArea.selectionStart - 1), inputArea.selectionStart);
                            let letterNum = (beforeLetter == "") ? -1 : "êë¶êëæêë©êë∑êë≠êëß".indexOf(beforeLetter);
                            let cursorAfterPos = inputArea.selectionStart;
                            if (letterNum == -1){
                                inputArea.value =
                                    inputArea.value.substring(0, cursorAfterPos) +
                                    "êëª" +
                                    inputArea.value.substring(inputArea.selectionEnd);
                                //Âº∑Âà∂ÁöÑ„Å´„Éï„Ç©„Éº„Ç´„Çπ„ÇíÊàª„Åô
                                inputArea.focus({ focusVisible: false });
                                inputArea.selectionEnd = inputArea.selectionStart = cursorAfterPos + 2;
                            }else{
                                let newLet = "êëΩêëΩêëºêëπêë∏êë∫".substring(letterNum, letterNum+2);
                                inputArea.value =
                                    inputArea.value.substring(0, cursorAfterPos-2) +
                                    newLet +
                                    inputArea.value.substring(inputArea.selectionEnd);
                                //Âº∑Âà∂ÁöÑ„Å´„Éï„Ç©„Éº„Ç´„Çπ„ÇíÊàª„Åô
                                inputArea.focus({ focusVisible: false });
                                inputArea.selectionEnd = inputArea.selectionStart = cursorAfterPos;
                            }
                        }
                    }, "êë´", "êë≤",
                    //Á¨¨3ÊÆµ
                    "êëë", "êëõ", "êëï", "êëü", "êëØ", "êëÆ", "êë±", "êë©", "êë¥", "êë¨",
                    //Á¨¨4ÊÆµ
                    {
                        display: "‚Üê",
                        handler: defaultKeyHandlers.moveLeft
                    },
                    {
                        display: "‚Üí",
                        handler: defaultKeyHandlers.moveRight
                    },
                    "êëî", "êëû", "¬∑", "êë§", "êëß", "êë≥", "êë∑", "êë∂",
                    //Á¨¨5ÊÆµ
                    "êëê", "êëö", "êëì", "êëù", "êë•", "êë¢", "êë®", "êë≠", "êë™", {
                        display: "‚å´",
                        handler: defaultKeyHandlers.delPrev
                    }
                ]
            },
            //„Ç¨„É©„Ç±„ÉºÊâì„Å°23„Ç≠„Éº (KG-≈†≈Ω-≈äH): „Åì„Åì„Åã„ÇâÊú™ÂÆåÊàê
            "shavian.doubleTap": {
                nameTranslationID: "keyboards.doubleTap.name",
                style: "grid",
                size: {
                    width: 6,
                    height: 4
                },
                keys: [
                    "êëíêëú", "êëñêë†", "êëôêë£", "êë¶êë∞", "êëµêë´", "êëø",
                    "êëóêë°", "êëïêëü", "êëòêë¢", "êë±êë≤", "êëª", "êë¨êë∂",
                    "êëëêëõ", "êëîêëû", "êëÆêë§", "êë®êëß", "êë©êë™", "êë¥",
                    "êëêêëö", "êëìêëù", "êëØêë•", "êë≠êë∑", "êë≥", {
                        display: "‚å´",
                        handler: defaultKeyHandlers.delPrev
                    }
                ]
            },
            //ÂΩ¢Áä∂„Ç∞„É´„Éº„Éó (PTKF√ûS)
            //Shaw Imperial (OjAw≈¨G≈†ƒå)
            //Shaw QWERTY (AwWERTA)
            
            //Ë®òÂè∑
            //Âü∫Êú¨„ÅÆË®òÂè∑„Ç≠„Éº„Éú„Éº„Éâ
            "symbols": {
                nameTranslationID: "keyboards.phonetic.name",
                style: "grid",
                size: {
                    width: 10,
                    height: 5
                },
                keys: [
                    "1", "2", "3", "4", "!", "?", "+", "-", "*", "=",
                    "5", "6", "7", "8", "(", ")", "{", "}", "[", "]",
                    "9", "a", "b", "c", ":", ";", "/", "\\", "^", "%",
                    "d", "e", "f", "0", "@", "#", "&", "|", "$", "~",
                    "x", "y", "<", ">", "¬´", "¬ª", "'", "\"", "`", {
                        display: "‚å´",
                        handler: defaultKeyHandlers.delPrev
                    }
                ]
            }
            //Ë®òÂè∑„Ç¨„É©„Ç±„ÉºÊâì„Å°
            
            //„É©„ÉÜ„É≥ÊñáÂ≠ó
        };
        
        function prepareKeyboard(id, keyArea) {
            let k = keyboardInfo[id];
            if (k.style == "grid") {
                //cssÁî®ÊÑè
                keyArea.classList.add("gridKeyboard");
                keyArea.style.height = `calc(${k.size.height} * var(--key-height)`; // k.size.height;
                {
                    let t = "1fr";
                    for (let i = 0; i < k.size.width - 1; i++) {
                        t += " 1fr";
                    }
                    keyArea.style["grid-template-columns"] = t;
                }

                //„Ç≠„ÉºÈÖçÁΩÆ
                for (let key of k.keys) {
                    let keySlotElem = document.createElement("div");
                    keyArea.appendChild(keySlotElem);
                    keySlotElem.classList.add("keySlot");
                    if (typeof key == "string") {
                        keySlotElem.innerHTML = key;
                    } else {
                        keySlotElem.innerHTML = key.display;
                        if (key.position) keySlotElem.style["grid-area"] = key.position;
                        //keySlotElem.style["grid-area"] = (key.position.y + 1) + " / " + (key.position.x + 1);

                        if (key.display === null) {
                            keySlotElem.classList.add("notKey");
                            if (!key.handler) continue;
                        }
                    }
                    keyArea.appendChild(keySlotElem);

                    //„Éè„É≥„Éâ„É©Ë®≠ÂÆö
                    if (key.handler){
                        keySlotElem.setClick(key.handler);
                        continue;
                    }
                    if (k.handler){
                        keySlotElem.setClick(k.handler);
                        continue;
                    }
                    keySlotElem.setClick(defaultKeyHandlers.letter);
                }
            }
        }
        prepareKeyboard("shavian.phonetic", getElem("mainKeys"));
        prepareKeyboard("symbols", getElem("symbolKeys"));
        getElem("spaceBar").setClick(defaultKeyHandlers.letter);
        getElem("periodKey").setClick(defaultKeyHandlers.letter);
        getElem("commaKey").setClick(defaultKeyHandlers.letter);
        getElem("enterKey").setClick(defaultKeyHandlers.enter);
        getElem("switchButton").setClick(function(){
            if (getElem("mainKeys").classList.contains("current")){
                getElem("mainKeys").classList.remove("current");
                getElem("symbolKeys").classList.add("current");
            }else{
                getElem("mainKeys").classList.add("current");
                getElem("symbolKeys").classList.remove("current");
            }
        })
        //Loch(X), Ghent(ƒû), Why(«∂), Llan(Íû≠), Yeah(E√´), Oeuvre(≈í)
    </script>
</html>
