
<!doctype html>
<html lang="ja">
    <head>
        <meta charset="utf-8" />
        <title data-translation-key="ui.appName">
            Shavian Alphabet Soft Keyboard
        </title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="pagename" content="Shavian Alphabet Soft Keyboard (wip)" />
        <meta name="author" content="Kumafuji1202" />
        <meta name="twitter:url" content="https://kumafuji1202.github.io/linguistics/shavian-keyboard/" />
        <meta name="keywords" content="Shavian, Â·ğ‘–ğ‘±ğ‘ğ‘¾ğ‘¯, Shavian input">
        <link
            rel="canonical"
            href="https://kumafuji1202.github.io/linguistics/shavian-keyboard/" />
        <meta
            name="twitter:title"
            content="Shavian Alphabet Soft Keyboard (wip)" />
        <meta
            name="twitter:description"
            content="" />
        <meta name="theme-color" content="#001020" />
        <link rel="stylesheet" href="../../css-global/global.css" />
        <link rel="stylesheet" href="../../css-global/centered-contents.css" />
        <script src="../../js-global/lang.js"></script>
        <script src="../../js-global/utils.js"></script>
        <style>
            html {
                background-color: #001020;
                --midground: #001525;
                --outer-text: #ffffff;
                --global-glow: 3px;
                --input-area-bg: #000000;
                --input-text: #ffffff;
                --kbd-main-bg: #003040;
                --kbd-bottom-bg: #002030;
                --key-height: 3em;
                --key-bg: #00c080;
                --key-text: #ffffff;
                --key-active-text: #000000;
                --key-active: #a0ccff;
                --key-slot-active-bg: #a0e0ff;
                color: var(--outer-text);
                text-shadow: 0px 0px var(--global-glow) var(--outer-text);
            }
            button {
                border-color: #aaa;
            }
            #contents {
                background: var(--midground);
                display: flex;
                flex-direction: column;
                padding: 0;
            }
            ul {
                list-style: none;
            }
            ul.keyboardRow {
                display: flex;
            }
            h1{
                font-size: 20px;
            }
            #inputArea {
                resize: none;
                font: inherit;
                border: none;
                flex-grow: 1;
                background: var(--input-area-bg);
                color: var(--input-text);
                text-shadow: 0px 0px var(--global-glow) var(--input-text);
            }
            #inputArea:placeholder-shown{
                text-shadow: none;
            }
            #keyboard {
                width: inherit;
                /*position: fixed;*/
                bottom: 0;
                user-select: none;
                align-content: center;
            }
            .keyArea {
                background: var(--kbd-main-bg);
                display: none;
            }
            .keyArea.gridKeyboard.current {
                display: grid;
            }
            #bottomBar {
                height: var(--key-height);
                background: var(--kbd-bottom-bg);
                display: flex;
                flex-direction: row;
            }
            #bottomBar > div {
                width: calc(1 * var(--key-height));
            }
            #bottomBar > div#spaceBar {
                font-size: 20px;
                flex-grow: 1;
            }
            .keySlot {
                align-content: center;
                transition-duration: 0.5s;
                transition-delay: 100ms;
                color: var(--key-text);
                text-shadow: 0px 0px var(--global-glow) var(--key-text);
            }
            .keySlot:not(.notKey):active {
                background: var(--key-slot-active-bg);
                transition-duration: 0s;
                transition-delay: 0s;
                color: var(--key-active-text);
                text-shadow: 0px 0px var(--global-glow) var(--key-active-text);
            }
            .key {
                background: var(--key-bg);
                color: var(--key-text);
            }
            a {
                color: inherit;
                text-decoration: none;
            }
        </style>
    </head>

    <body>
        <div id="container-flex">
            <div id="contents">
                <h1 data-translation-key="ui.appName"></h1>
                <nav>
                    <button>
                        <a href="../../" data-translation-key="ui.backToTop"></a>
                    </button>
                    <label
                        for="languageSelectBox"
                        data-translation-key="ui.langSelect.label"></label>
                    <select id="languageSelectBox"></select>
                </nav>
                <textarea
                    id="inputArea"
                    data-translation-key="ui.inputArea"
                    autocomplete="off"
                    autocorrect="off"
                    spellcheck="false"
                    inputmode="none"
                    rows="10"></textarea>
                <label for="inputArea">
                    <div id="keyboard">
                        <div class="keyArea current" id="mainKeys"></div>
                        <div class="keyArea" id="symbolKeys"></div>
                        <div id="bottomBar"><!--
                            <div class="keySlot" title="switch to Orthodox">
                                
                            </div>-->
                            <div class="keySlot" title="switch" id="switchButton">
                                ğ‘’/@
                            </div>
                            <!--<div class="keySlot" title="Settings">
                                âš™
                            </div>-->
                            <div class="keySlot" id="commaKey">,</div>
                            <div class="keySlot" data-output=" " id="spaceBar" data-translation-key="keyboards.phonetic.name"></div>
                            <div class="keySlot" id="periodKey">.</div>
                            <div class="keySlot" id="enterKey">
                                â†²
                            </div>
                        </div>
                    </div>
                </label>
            </div>
        </div>
    </body>

    <script>
        //ç¿»è¨³ãƒ‡ãƒ¼ã‚¿
        var lang = new LanguageManager({
            languages: [
                {
                    name: "English",
                    code: "en"
                },
                {
                    name: "æ—¥æœ¬èª",
                    code: "ja"
                },
                {
                    name: "Â·ğ‘¦ğ‘™ğ‘œğ‘¤ğ‘¦ğ‘– (ğ‘–ğ‘±ğ‘ğ‘¾ğ‘¯ ğ‘¨ğ‘¤ğ‘“ğ‘©ğ‘šğ‘§ğ‘‘)",
                    code: "en-Shaw"
                }
            ],
            translations: {
                "ui.appName": {
                    en: "Shavian Soft Keyboard (wip)",
                    ja: "ã‚·ãƒ§ãƒ¼æ–‡å­—ã‚½ãƒ•ãƒˆã‚­ãƒ¼ãƒœãƒ¼ãƒ‰(ä½œæˆä¸­)",
                    "en-Shaw": "Â·ğ‘–ğ‘±ğ‘ğ‘¾ğ‘¯ ğ‘•ğ‘ªğ‘“ğ‘‘ ğ‘’ğ‘°ğ‘šğ‘¹ğ‘› (â¸°ğ‘¢ğ‘¦ğ‘)"
                },
                "ui.langSelect.label": {
                    en: "Select Language/Script",
                    ja: "è¨€èª/æ–‡å­—ã‚’é¸æŠ",
                    "en-Shaw": "ğ‘•ğ‘©ğ‘¤ğ‘§ğ‘’ğ‘‘ ğ‘¤ğ‘¨ğ‘™ğ‘œğ‘¢ğ‘¦ğ‘¡ ğ‘¯ ğ‘•ğ‘’ğ‘®ğ‘¦ğ‘ğ‘‘"
                },
                "ui.inputArea": {
                    en: "Input here...",
                    ja: "ã“ã“ã«å…¥åŠ›â€¦",
                    "en-Shaw": "ğ‘¦ğ‘¯ğ‘ğ‘µğ‘‘ ğ‘£ğ‘½..."
                },
                "keyboards.phonetic.name": {
                    en: "Phonetic (KGÅŠH)",
                    ja: "è¡¨éŸ³ (KGÅŠH)",
                    "en-Shaw": "ğ‘“ğ‘©ğ‘¯ğ‘§ğ‘‘ğ‘¦ğ‘’ (ğ‘’ğ‘œğ‘™ğ‘£)"
                },
                "ui.backToTop": {
                    en: "Return to Top Page",
                    ja: "ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹",
                    "en-Shaw": "ğ‘®ğ‘¦ğ‘‘ğ‘»ğ‘¯ ğ‘‘ ğ‘‘ğ‘ªğ‘ ğ‘ğ‘±ğ‘¡"
                }
            }
        });
        lang.initSite(document.getElementById("languageSelectBox"));

        //ã“ã“ã‹ã‚‰å…¥åŠ›
        var inputArea = getElem("inputArea");
        
        var defaultKeyHandlers = {
            //æ—¢å®šã®ã‚­ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ã€‚ã‚­ãƒ¼ã®ä¸­èº«ã‚’ãã®ã¾ã¾å‡ºåŠ›ã™ã‚‹ã€‚
            letter: (e) => {
                e.preventDefault();
                let cursorAfterPos = inputArea.selectionStart;
                let output =
                    e.target.getAttribute("data-output") || e.target.innerHTML;
                inputArea.value =
                    inputArea.value.substring(0, cursorAfterPos) +
                    output +
                    inputArea.value.substring(inputArea.selectionEnd);
                //å¼·åˆ¶çš„ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’æˆ»ã™
                inputArea.focus({ focusVisible: false });
                inputArea.selectionEnd = inputArea.selectionStart = cursorAfterPos + output.length;
            },
            enter: (e) => {
                e.preventDefault();
                inputArea.value =
                    inputArea.value.substring(0, inputArea.selectionStart) +
                    "\n" +
                    inputArea.value.substring(inputArea.selectionEnd);
                //å¼·åˆ¶çš„ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’æˆ»ã™
                inputArea.focus({ focusVisible: false });
                inputArea.selectionEnd = ++inputArea.selectionStart;
            },
            //ã‚«ãƒ¼ã‚½ãƒ«ã‚’ç§»å‹•ã•ã›ã‚‹ã‚­ãƒ¼
            moveLeft: (e) => {
                e.preventDefault();
                //å¼·åˆ¶çš„ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’æˆ»ã™
                inputArea.focus({ focusVisible: false });
                inputArea.selectionEnd = inputArea.selectionStart -= (inputArea.value.charAt(inputArea.selectionStart - 1).isSurrogate() ? 2 : 1);
            },
            moveRight: (e) => {
                e.preventDefault();
                //å¼·åˆ¶çš„ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’æˆ»ã™
                inputArea.focus({ focusVisible: false });
                inputArea.selectionEnd = inputArea.selectionStart += (inputArea.value.charAt(inputArea.selectionStart).isSurrogate() ? 2 : 1);
            },
            //1æ–‡å­—å·¦ã‚’å‰Šé™¤
            delPrev: (e) => {
                e.preventDefault();
                let cursorAfterPos = inputArea.selectionStart;
                if (cursorAfterPos != 0){ //å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆã®å§‹ã‚ã«ã‚«ãƒ¼ã‚½ãƒ«ãŒã‚ã‚‹ãªã‚‰ä½•ã‚‚ã—ãªã„
                    //å‰ãŒutf16ã§2ãƒã‚¤ãƒˆæ–‡å­—ã‹4ãƒã‚¤ãƒˆæ–‡å­—ã‹ã‚’åˆ¤å®š(ã‚«ãƒ¼ã‚½ãƒ«ã®ç›´å‰ã®ãƒã‚¤ãƒˆãŒã‚µãƒ­ã‚²ãƒ¼ãƒˆã‹åˆ¤å®š)
                    let removeStringSize = inputArea.value.charAt(cursorAfterPos - 1).isSurrogate() ? 2 : 1;
                    inputArea.value = inputArea.value.substring(0, cursorAfterPos - removeStringSize) + inputArea.value.substring(inputArea.selectionEnd);
                    inputArea.selectionEnd = inputArea.selectionStart = cursorAfterPos - removeStringSize;
                }
                //å¼·åˆ¶çš„ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’æˆ»ã™
                inputArea.focus({ focusVisible: false });
            }
        };

        var keyboardInfo = {
            //displayã¯nullã«ã™ã‚‹ã¨handlerãŒæŒ‡å®šã•ã‚Œãªã„é™ã‚Šæ—¢å®šãƒãƒ³ãƒ‰ãƒ©ã¯å‰²ã‚Šå½“ã¦ã‚‰ã‚Œãªã„ã€‚
            //handlerã¯è¨­å®šã—ãŸã‚‰ãã®é…ç½®ã®ã™ã¹ã¦ã®ã‚­ãƒ¼ã®å‡¦ç†ã‚’ãã‚Œã§ä»£ã‚ã‚Šã«è¡Œã†ã€‚
            //keys[#].handlerã¯è¨­å®šã—ãŸã‚‰ãã®ç‰¹å®šã®ã‚­ãƒ¼ã«ã ã‘å‡¦ç†ã‚’ãã‚Œã§ä»£è¡Œã™ã‚‹ã€‚
            //å„ªå…ˆåº¦: ã‚­ãƒ¼å€‹åˆ¥ãƒãƒ³ãƒ‰ãƒ© > é…ç½®æ—¢å®šãƒãƒ³ãƒ‰ãƒ© > defaultKeyHandlers.letter
            
            //ã‚·ãƒ§ãƒ¼æ–‡å­—
            //è¡¨éŸ³44ã‚­ãƒ¼ (KGÅŠH)
            "shavian.phonetic": {
                nameTranslationID: "keyboards.phonetic.name",
                style: "grid",
                size: {
                    width: 10,
                    height: 5
                },
                keys: [
                    //ç¬¬1æ®µ
                    "ğ‘’", "ğ‘œ", {
                        display: null,
                        position: "1 / 3 / 2 / 5"
                    }, "ğ‘™", "ğ‘£", "ğ‘°", "ğ‘¾", "ğ‘µ", "ğ‘¿",
                    //ç¬¬2æ®µ
                    "ğ‘—", "ğ‘¡", "ğ‘–", "ğ‘ ", "â¸°", "ğ‘˜", "ğ‘¦", {
                        // Råˆå­—ã‚­ãƒ¼
                        display: "ğ‘»/â—Œğ‘®",
                        handler: e => {
                            let beforeLetter = inputArea.value.substring(inputArea.selectionStart - inputArea.value.lengthAt(inputArea.selectionStart - 1), inputArea.selectionStart);
                            let letterNum = (beforeLetter == "") ? -1 : "ğ‘¦ğ‘¾ğ‘©ğ‘·ğ‘­ğ‘§".indexOf(beforeLetter);
                            let cursorAfterPos = inputArea.selectionStart;
                            if (letterNum == -1){
                                inputArea.value =
                                    inputArea.value.substring(0, cursorAfterPos) +
                                    "ğ‘»" +
                                    inputArea.value.substring(inputArea.selectionEnd);
                                //å¼·åˆ¶çš„ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’æˆ»ã™
                                inputArea.focus({ focusVisible: false });
                                inputArea.selectionEnd = inputArea.selectionStart = cursorAfterPos + 2;
                            }else{
                                let newLet = "ğ‘½ğ‘½ğ‘¼ğ‘¹ğ‘¸ğ‘º".substring(letterNum, letterNum+2);
                                inputArea.value =
                                    inputArea.value.substring(0, cursorAfterPos-2) +
                                    newLet +
                                    inputArea.value.substring(inputArea.selectionEnd);
                                //å¼·åˆ¶çš„ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’æˆ»ã™
                                inputArea.focus({ focusVisible: false });
                                inputArea.selectionEnd = inputArea.selectionStart = cursorAfterPos;
                            }
                        }
                    }, "ğ‘«", "ğ‘²",
                    //ç¬¬3æ®µ
                    "ğ‘‘", "ğ‘›", "ğ‘•", "ğ‘Ÿ", "ğ‘¯", "ğ‘®", "ğ‘±", "ğ‘©", "ğ‘´", "ğ‘¬",
                    //ç¬¬4æ®µ
                    {
                        display: "â†",
                        handler: defaultKeyHandlers.moveLeft
                    },
                    {
                        display: "â†’",
                        handler: defaultKeyHandlers.moveRight
                    },
                    "ğ‘”", "ğ‘", "Â·", "ğ‘¤", "ğ‘§", "ğ‘³", "ğ‘·", "ğ‘¶",
                    //ç¬¬5æ®µ
                    "ğ‘", "ğ‘š", "ğ‘“", "ğ‘", "ğ‘¥", "ğ‘¢", "ğ‘¨", "ğ‘­", "ğ‘ª", {
                        display: "âŒ«",
                        handler: defaultKeyHandlers.delPrev
                    }
                ]
            },
            //ã‚¬ãƒ©ã‚±ãƒ¼æ‰“ã¡23ã‚­ãƒ¼ (KG-Å Å½-ÅŠH): ã“ã“ã‹ã‚‰æœªå®Œæˆ
            "shavian.doubleTap": {
                nameTranslationID: "keyboards.doubleTap.name",
                style: "grid",
                size: {
                    width: 6,
                    height: 4
                },
                keys: [
                    "ğ‘’ğ‘œ", "ğ‘–ğ‘ ", "ğ‘™ğ‘£", "ğ‘¦ğ‘°", "ğ‘µğ‘«", "ğ‘¿",
                    "ğ‘—ğ‘¡", "ğ‘•ğ‘Ÿ", "ğ‘˜ğ‘¢", "ğ‘±ğ‘²", "ğ‘»", "ğ‘¬ğ‘¶",
                    "ğ‘‘ğ‘›", "ğ‘”ğ‘", "ğ‘®ğ‘¤", "ğ‘¨ğ‘§", "ğ‘©ğ‘ª", "ğ‘´",
                    "ğ‘ğ‘š", "ğ‘“ğ‘", "ğ‘¯ğ‘¥", "ğ‘­ğ‘·", "ğ‘³", {
                        display: "âŒ«",
                        handler: defaultKeyHandlers.delPrev
                    }
                ]
            },
            //å½¢çŠ¶ã‚°ãƒ«ãƒ¼ãƒ— (PTKFÃS)
            //Shaw Imperial (OjAwÅ¬GÅ ÄŒ)
            //Shaw QWERTY (AwWERTA)
            
            //è¨˜å·
            //åŸºæœ¬ã®è¨˜å·ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰
            "symbols": {
                nameTranslationID: "keyboards.phonetic.name",
                style: "grid",
                size: {
                    width: 10,
                    height: 5
                },
                keys: [
                    "1", "2", "3", "4", "!", "?", "+", "-", "*", "=",
                    "5", "6", "7", "8", "(", ")", "{", "}", "[", "]",
                    "9", "a", "b", "c", ":", ";", "/", "\\", "^", "%",
                    "d", "e", "f", "0", "@", "#", "&", "|", "$", "~",
                    "x", "y", "<", ">", "Â«", "Â»", "'", "\"", "`", {
                        display: "âŒ«",
                        handler: defaultKeyHandlers.delPrev
                    }
                ]
            }
            //è¨˜å·ã‚¬ãƒ©ã‚±ãƒ¼æ‰“ã¡
            
            //ãƒ©ãƒ†ãƒ³æ–‡å­—
        };
        
        function prepareKeyboard(id, keyArea) {
            let k = keyboardInfo[id];
            if (k.style == "grid") {
                //cssç”¨æ„
                keyArea.classList.add("gridKeyboard");
                keyArea.style.height = `calc(${k.size.height} * var(--key-height)`; // k.size.height;
                {
                    let t = "1fr";
                    for (let i = 0; i < k.size.width - 1; i++) {
                        t += " 1fr";
                    }
                    keyArea.style["grid-template-columns"] = t;
                }

                //ã‚­ãƒ¼é…ç½®
                for (let key of k.keys) {
                    let keySlotElem = document.createElement("div");
                    keyArea.appendChild(keySlotElem);
                    keySlotElem.classList.add("keySlot");
                    if (typeof key == "string") {
                        keySlotElem.innerHTML = key;
                    } else {
                        keySlotElem.innerHTML = key.display;
                        if (key.position) keySlotElem.style["grid-area"] = key.position;
                        //keySlotElem.style["grid-area"] = (key.position.y + 1) + " / " + (key.position.x + 1);

                        if (key.display === null) {
                            keySlotElem.classList.add("notKey");
                            if (!key.handler) continue;
                        }
                    }
                    keyArea.appendChild(keySlotElem);

                    //ãƒãƒ³ãƒ‰ãƒ©è¨­å®š
                    if (key.handler){
                        keySlotElem.setClick(key.handler);
                        continue;
                    }
                    if (k.handler){
                        keySlotElem.setClick(k.handler);
                        continue;
                    }
                    keySlotElem.setClick(defaultKeyHandlers.letter);
                }
            }
        }
        prepareKeyboard("shavian.phonetic", getElem("mainKeys"));
        prepareKeyboard("symbols", getElem("symbolKeys"));
        getElem("spaceBar").setClick(defaultKeyHandlers.letter);
        getElem("periodKey").setClick(defaultKeyHandlers.letter);
        getElem("commaKey").setClick(defaultKeyHandlers.letter);
        getElem("enterKey").setClick(defaultKeyHandlers.enter);
        getElem("switchButton").setClick(function(){
            if (getElem("mainKeys").classList.contains("current")){
                getElem("mainKeys").classList.remove("current");
                getElem("symbolKeys").classList.add("current");
            }else{
                getElem("mainKeys").classList.add("current");
                getElem("symbolKeys").classList.remove("current");
            }
        })
        //Loch(X), Ghent(Ä), Why(Ç¶), Llan(ê­), Yeah(EÃ«), Oeuvre(Å’)
    </script>
</html>
